from ipwhois import IPWhois
import socket
import pandas as pd
import re
from urllib.parse import urlparse

#ip 가져오기
def get_ip_address(domain):
    try:
        ip_address = socket.gethostbyname(domain)
        return ip_address
    except (socket.gaierror, socket.error, socket.herror, socket.timeout) as e:
        print(f"Error getting IP address for {domain}: {e}")
        return None
    
#whois 정보 가져오기
def get_whois_info(domain):
    ip_address = get_ip_address(domain)
    
    if ip_address is not None:
        ipwhois = IPWhois(ip_address) 
        try:
            result = ipwhois.lookup_rdap()  # RDAP로 조회
            return result
        except Exception as e:
            print(f"Error looking up RDAP for {ip_address}: {e}")
    return None

#normal_netnames_df = pd.read_csv('path/to/normal_netnames.csv') #나중에 추가해야함...!
#NORMAL_NETNAMES = normal_netnames_df['netname'].tolist()
#netname 가져오기
def get_netname(url):
    parts = urlparse(url)
    domain = parts.hostname
    whois_info = get_whois_info(domain) 
    
    if whois_info is not None:
        nets_info = whois_info.get('network', {})
        name = nets_info.get('name', '')
        if name:
            if name in NORMAL_NETNAMES:
                return None  # Return None for normal netnames
            return name
        else:
            print(f"No nets information for {domain}")
    else:
        print(f"Unable to retrieve WHOIS information for {domain}")
    return None

def check_netname(netname): #악성url의 netname과 같은지 비교
    Match=re.search('GIR_SER-NET|Virtuo|348208|CHINANET-YN|CHINANET-LN|CHINANET-JS|sxtybas|CHINANET-HN|sxlfbas|CHINANET-SX|sxdtbas|CHINANET-JL|sxyqbas|EMOME-NET|sxczbas|sxxzbas|TELECOM-ADSL-POOL|sxszbas|CHINANET-ZJ|ATLANTA-CCS-1|HU-HDSNET-20070705|AWEX-CLOUD-000WEBHOST-1|SPRINTHOST-NET-195|HT-Hosting|Alsycon-customers|OVH-CUST-270799823|NET-NAME-ID-1721|XHOSTIS-NET|EVILEMPIRE-MNT|MAXKO|LT-HOSTBALTIC-10|Neterra-Mortal_Soft-NET|ORG-VL5-AFRINIC|GL-IX-NET|CC-18|VPSTTT-VN|CC-16|UNICOM-SD|HOSTINGER-HOSTING|BX-NETWORK|MAXISBROADBAND-AS-AP|ES-MUNDITELECOM-20191226|CM-SH-ML-TW|DTAG-DIAL20|GEMINI-NETWORKS|CHINANET-GZ|IBERCOMNET|VODAFONE-IT-63|Tube-Hosting|UNICOM-CN|WORLD-ISP-NETWORK|RELIABLESITE-AP|Tamatiya-EOOD|INU-VPS01|TCITHR|IT-TIWS-20090115|VODAFONE-IT|CHINANET-HN-CD|Lethost-LLC|YUH-VN|sxllbas|Cloudx-netv4|CABLEONE|MEMPHIS-3|RRMA|TOCDOVIET-VN|unixserv|MDNHD-PRIVATE|sxpdsn|Sabanet-Isfahan|CYTANET|ATSTEL-RU|NHATLONG-VN|Smartape|AEZA-NETWORK-PARIS|ROYALE-45-140-140-0|sxycbas|BROADBAND-CABLE-VOO|SINGNET-SG|sucom|Private_Customers|SEEDNET-NET|tckhr-DSL|VIS-71-96|sxjcbas|SLTADSL-SLT-LK|VEETIME-TW|VZ-DSLDIAL-NYCMNY-10|UK-SELABS|SC-ELITETEAM-20201113|ALTAWK-HEL5|LIME_NET-NET|NET-69-46-0-0-19|NET-NAME-ID-1414|Souza_NET|WernerTeam|FCC-212|GIR_SER_NET|UNIFIEDLAYER-NETWORK-16|I123-1521601840-2014810|OCN|92791|MIAMI-25|IT-TIN-20030807|TCIKHR|CHIEF-AS-AP|MEGALAYER-GCNT-NET-1|ONO|CABLES-L2TP|ZCOM-TH-ENTERPRISE|FDI-LTE-BSNS-S|Topway-Net|GOFIBER-SOFTWARE-VN|CHARLESTON-21|RU-ISP-SIBNET-NSK-6|HU-VODAFONE-20110608|PROCONO-NET|SKY-IT-BROADBAND|iDeal-Dedicated-Server|Rokada|NV-FIXEDIP-6|EKO-LINE|MEVSPACE|DE-XSSERVER4-20190819|SUNCOM-Docsis-3-1|JCOM-NET|HCN-KR|ALICLOUD-HK|VODAFONE_SPAIN_NETWORK|TELECOM-ADSL-IPTV|VIS-BLOCK|KABEL-DEUTSCHLAND-CUSTOMER-SERVICES-17|KBRO-NET|INTERSERVER|DK-TELEDANMARK-20050520|SUZHOU-CS-DONGFANG-KNITTING-CORP|JTCL-JP|BB-Multiplay-Static|QUALITY|IR-RSPN-20101202|ES-DIGI-SPAIN|RackSrvr|RU-CHANGWAY-20230823|VDSINA-NET|ES-AIRTEL-20061206|STARNETMD|DIGITALOCEAN|CC-172-245-208-0-25|FASTWEB-VULA_Statico|CTG107-40-HK|ONECOM-INFRA|ORG-SL72-AFRINIC|IR-MCI-20100317|WIRELESSDATANEWORK|CM-CCTV-TC-TW|DK-TELIANET-20150414|PT-ALMOUROLTEC|NL-KRIEK-20210730|A2HOS|Orange_Romania_Communications|RU-CLOUDRU-20050722|OOC-195|NET-WEHOST-1|HOSTVISION-SRL|KABEL-DEUTSCHLAND-CUSTOMER-SERVICES-19|TELECOM-ADSL|Xtra-Telecom-SA-139-47-0-0|MANITU-NET-ROOTSERVER-2|HGBLOCK-10|ORACLE-4|oracle|POMPANO-4|PG19-Rostov-on-Don|PDR-SOLUTIONS|NET-216-194-122-128-SLASH-27|AFRARASA|ALICE-SMART|V4-VZO|BEZEQ-ISP-BROADBAND|TurkTelekom|NETVIGATOR|RU-CHANGWAY-20210917|IL-BEZEQ-INTERNATIONAL-20030512|NEFNET-DHCP|CLOUDFLY-VN|H3GUK|CMBI-NETDJ-KR|YAZ-DSL|Elite-Hosting-LTD|CACTUS-NET|TELECOM-ADSL-9|HOSHIN-MULTIMEDIA|SERVERS-RU-MOW1|zerohost_network|TBCOM-NET|ITACA-W3-IPBA|BARDSTOWNCABLEINTERNET|BT-CENTRAL-PLUS|WASUHZ|CTG79-168-KR|ABC-NL-NV-VPS|ORG-ATIA2-AFRINIC|NDCHOST|VPS-GRA|HGBLOCK-9|DXTNET|IQHost|BODIS-COM|HOSRAJA|BZ-ESCUR1|VA-TECH|EURNETCITY|JDCOM|PIN-DATACENTER-NET|cust-guzelhosting|ES-MUNDITELECOM-19950717|SKY-BROADBAND|RIKT-NET|PEER1-BLK-08|SIS-80-8-3-13|Uteam|TCIALB|MICROSENSE-IN|M-REAL-BG|UBBNET-NET|LG-HELLOVISION-KR|RIMA|SHTL-Mobile|CC04|IL-NETVISION-960131|CBC-C-CAL-25|ATLANTA-11|OPTUSINTERNET-AU|DIMENOC-243675|CPANEL_hosting|HKBN|HCT-NET|IP2000-ADSL-BAS|IE-DIGIWEB-20040524|BGP160-JP|ROADRUNNER-NYC-2|Sparkstation-SG|OOL-CPE-NYX1NY-24-45-160-0-22|NL-193-176-31-0|PL-BYDMAN-20110208|456678|206-221-176-232-29|HK-CATTECHNOLOGIES|SE-TELE2-BROADBAND|TYCATV-NET|UK-EXPONENTIAL-E-20120713|Wi-Fast-Sliven|CTM-MO|EVOKEDS|ES-PROCONO-AS-970903|TCAW-DSL|RES-CMTSHAWPTDNET|HU-VODAFONE-20101013|mztci-dsl|RU-BUZULUK-20160302|BG-BTC-20020905|BEZEQINT-BROADBAND|KGT-NET|Telekom_Romania|tinp-net|Promtelecom|CYPE-MY|ERTH-SPB-MAIN-NET|IL-NETVISION-20000801|IR-DORNA-DCUSTUMER-20140507|BHN-12|FASTWEB-INTERNET-NGA|TELENET|DUROK|BARAK-11|WOPW|KE-ING-NET|Mobiltel_BNG|BREDBAND2-NET-SE|FARLINE-NET|119438|CTM-AS-AP|RU-REDBYTES|RO-CLARTELEVISION|HU-VODAFONE-20010715|ODSJSC-VN|UNIFIEDLAYER-NETWORK-15|JUNIUYUN-CN|FCC-210|SBBNET|75-88-248-0|TRIOLAN|BT-ADSL|FASTWEB-L3-PAT_NAT|APEX|UBN|FASTWEB-POP-INTERNET_SINGOLO|RRSW|AAPTLimited|ESAMARA-PPPOE-1-NET|NGI-NET|LTC-HOME|CTK-NET|VMCBBUK|SNT-FILAR|AIRFIBER|APT-NET|SHYAMSPECTRA-IN|IL-NETVISION-990212|SBCIS-SBIS-6BLK|VOLIA-KH|RU-ITRESHENIYA|PLANINTERNET-FRA|CHINANET-HN-HH|STARRY-CGNT-NET-4|UNI2-NET|SABANET-AHVAZ|BULSATCOM|MT-BROADBAND-DYNAMIC-KTV|MNETBG2|MEO-BROADBAND|IT-INTERBUSINESS-971107|HU-VODAFONE-20060117|RU-YANDEXCLOUD|ORG-HP1-AFRINIC|SHINJIRU-MY|UNICOM-HB|RU-KISARA-20230221|CONTA-48|HETZNER-fsn1-dc7|AL-HUNT|ES-XFERA|NET-24-153-218-160-1|PTS-DSL-Zone1|Xpeed-KR|NETBLK-PH-RDC-68-230-0-0|BTC-BROADBAND-NET-12|HGBLOCK-2|x33-Network|SRT|IDNIC-DISKOMINFOSMG-ID|Sefroyek-B2C|IPOWERWEB-NET|CDN|TLKM_BB_INF_36_64|SBC-108-65-15-56-29-1707250238|AS199785-RU-iPv4|RU-PROSPERO|SBCIS-SBIS|OOL-CPE-PRNYNJ-69-112-8-0-21|PLANETEL-PPXDSL|WINDSTREAM|RR-SOUTHEAST-BLK2|RRACI|RRNY|US-A2HOS-20160406|NTS-4|INTERNET-BLK-A2HOS-13|RACKH-ID|VIETSPEEED-VN|TT-20221122|SBC-104-183-208-232-29-1410020842|RU-MIRANDA-MEDIA-20100121|TPAT-HIGHSPEEDCAB-NET|FIRSTNFASTITLTD-BD|NEXTEL-XDSL|ELXIREDATA|INEA-Sp-z-oo|FARAHOOSHDENA|SOVINTEL-p2p-LL-NET|MEGADAT-237|61720|CENTRIN|RU-MTU-20120907|EVDO-SULAIMANY|CITYONLINELTD-BD|COMMSERVICEOFFICE|ILLINOIS-33|RR-WEST-2BLK|STSB-MY|WIDEBAND|SUPERDATA-VN|LIQUIDNET-HOSTING|US-INTERNET1-20090520|PA-PRIVATELAYERCOM-20110829|SE-LOOPIA|HR-DHH-PLUS-SHARED|DE-KEYWEB-II|LXN-KR|LWS-shared|AST-SYSTEMS-NET|NETBLK-SOFTLAYER-RIPE-CUST-AR44875-RIPE|JUMPBG-1|UNIFIEDLAYER-NETWORK-8|REGRU-NETWORK|RRPRI|EXBCOID-ID|EWEBGURU|CONETRIX|ATL-CLOUD|PRIVATE-DS-TX-2|BTC-BROADBAND-NET-11|UNIFI-HOME|174-80-0-0-1|KTB-PLUS|NETSONS|AITNET-1|KDATA-VN|ROAD-RUNNER-5|SUPERHOSTINGBG|AKVILON|FR-DN-PIECES-AUTO|IT2LTD-NET|ORG-BCSL1-AFRINIC|ADSL|IWEB-HD-T2728CL-96|TELEKOM-BB-NET|SHAW-COMM|MOBINNET|khorasan-razavi-ads|SC-NEXTGEN-COMMUNICATIONS-SRL|PUBLICDOMAINREGISTRY-NETWORKS|TOYA|IPXO|STARNET|FANAVADP|NO-TELENOR-DSL-4|APOL-NET|OPAL-DSL|TTDOTCOM-MY|FR-PROXAD-ADSL|CM-BEST-HC-TW|TCKERMAN-dsl|PLUSNET|EMAX-NET|Macroregional_South|Z-LAN|NETERRA-PLADI2-NET|ST-ADSLSTAT200-NET|POIG-NET|QUICK-LINK|TELEPAK-NETWORKS1|BIZNET-SEMBILAN-ANUGRAH-BLOCK|DSL-NET|330820|RIMON1-NET|BOUYGTEL-ISP-WIRELINE|PTS-NET|THEOFILAKTOU-GR|PRIMO-099|FASTWEB-GEMMI_LUCI|TR-MUVHOST2-20191114|NFRAME|CRYSTALTECH-BLK-5|286481|ReadyIDC|ES-INFORTELECOM-20041020|ESC-VN|PHPNET|TISCALINET|COMSATS|SAVECOM-NET|TR-HOSTLAB-20200115|IDNIC-IAINMATARAM-ID|DATT-66-97-32-0-22|SY-NANS-20170807|BLU-SH-02|NV-FIXEDIP-38|TOT-AP|NETNATION|TKP-S-TRONIK|ERTH-BRYANSK-PPPOE-NET|MT-MALTANET-RETAIL-DSL-2007043001|TADU-VN|TIS-NZ|GOLESTAN-TELECOMMUNICATION|IL-GOLDENLINES|BT-INFRA|MEDIACOM-RESIDENTIAL-CUST|ZAIN-KW|THE-MURRAY-BAR|VODAFONE-IT-46|XTRA-PYMES-20090130|BROADNET-CZ-ADSL|BE-BELGACOM-ADSL1|IT-NGI-20040819|SYMSTAT-20180222-CA17|SKYBB-PH|POMPANO-7|24SHELLS|RO-ORANGE|MUP-RIM-NET|SUDDE-NETBLK-208-180-0-0|OOL-CPE-NYK2NY-67-80-24-0-21|SCEOLT1-EPBFI-COM|NET-72-43-115-144-1|MF-GDC-20210810-T3693071|PANAMACITY-FL|SBC-107-135-46-248-29-1704101251|N9UF-DYN-DSL|OOL-STATIC-RH-WP-75-99-192-0-18|BNAA-DHCP|Docsis-Shoumen-A1BG|GOLDENLINES-CABLE|NL-DEMENIN|IGRA-SERVICE-136-0-21|BELTELECOM-DATACENTER-2011-6|BK-CLIENT|ORG-KAL1-AFRINIC|READYI-185-78-164-0|SBC-172-13-41-48-29-2211203556|UNIFIEDLAYER-NETWORK-3|INET-KR|PYTHON-A|LUUTRUSO-VN|ATNET-RU|UK-EUKHOST-20120613|CDNETWORKS-KR|MYNET-WLAN-OBERLAND|FR-PROXAD-20051003|KOCNET-SECURITY|WENZHOU-GAOJIE-CO|OOL-STATIC-RH-NY-108-58-112-0-21|PL-UPC-20090402|BEGET-NET-20|Uludag-Bilisim|ELXIRE_SERVICES|DENOPL|CAMNET-KH|TSHAH-IN|IDNIC-BIZNETGIO-ID|ENETDDN|OOL-STATIC-PRNYNJ-75-99-143-192-29|A1-1205|CTA-104-192-108-0-23|Enterprise-Customer|SP-DMZ|FALKON-PLUS-LAN|RS-TELEKOM-980224|Corporate-Customer|NO-KBAND-20170914|server1|ROKABEAR|NET-69-160-32-0-1|DIMENOC-NETWORK|GIGASNET-2|GGC-NET-37|Abissnet|REGISTERIT|IDNIC-IDCLOUDHOST-ID|IL-BEZEQ-INTERNATIONAL-20110328|WEST263|CHINANET-CN|HOSTERBY-9|NETAC-RDU|CORBYNORTH-LTD|CM110-CCTV-TC-TW|COLODEE|MAL-CA-24-176-192|DE-PROVIDERBOX-20160208|UK-34SP|TURNKEY-INTERNET|BIZLAND-FC01|AMC-NET-6|STRATO-RZG-DEDI|RACKS-8-NET-12|CM-CY-ML-TW|MEGA-2|TBCNET-TW|ECONOLODGE-POLYNESIAN|ROADRUNNER-2-MIDSOUTH|GOOGLE-FIBER|HOL-STATIC|LIMITLESS-HOSTING-01|NET-208-122-221-0-24|DCL|NTKTV|BG-BTC-20011128|ADNTL|ORG-IL11-AFRINIC|ALLIANCE-TELECOM|MOLDTELECOM-NET|VTXC-1|RU-SOVAM-MSK-Static-IP-Pool-NET|TLKM_D2_ASTINET_CUSTOMER_36_66|LINKINTEL|TBTELECOM|ASPAN-KZ-NET|BHTELECOM-CUSTOMERS-STATIC-VL94|CRTV-69-65-0-0|268211|AT-CYBERTRON-970325|GDRPL-IN|DE-NERDHERRSCHAFT-20150216|InnerMongoliaAlashanZXHB52MH01huawei20|DAOU-KR|DEESERVER-TH|Enzu-5-180|FB-NET|AMAZON-ARN|SDBB-LEGACY-NETBLOCK-01|UK-IFASTNET-20130530|XSERVER|DEFENDER-NETWORK|C4626-3-CZ-MAI|DIGITALOCEAN-198-211-96-0|DIGITALOCEAN-174-138-0-0|CC-14|WEEBLYNET1|IANA-BLOCK|MEEBO|DNC-HK|MEGA-II|66-223-0-0-NET|GODADDY-NET-SG|ATHENIX|ALCH-867|SA|DIGITALOCEAN-45-55-0-0|LBIL-HK|Galaxy-netv4|DIGITALOCEAN-143-198-0-0|NETWORK-LEAPSWITCH-IN|A2HOSTINGINC-AP|SERVER-GUATEMALA-LO-MEJOR-EN-TECNO-104-152-187-240|AEZA-USA-LA|COGENT-154-64-16|EGIHOSTING-4|Aeza-Network|HKOTC-HK|ANLIANNETWORK-HK|DREAMHOST-BLK5|DREAMHOST-BLK9|HG-GPX-Pool|RU-TIMEWEB2-20150826|OPENTRANSFER-ECOMMERCE|VPS-SYD2|ORG-DD1-AFRINIC|UNIFIEDLAYER-NETWORK-9|SpaceWeb|MEGA-6|LL|GOhost-KZ-NET|Racknerd|DIGITALOCEAN-138-68-0-0|DIGITALOCEAN-AP|NODISTO|SH-335|OVH|CONSTANTMOULIN|DO-13|BG-ZETTA|Ransom_IT_Infrastructure|COGENT-206-119-16|NETSOL|INFRA|RUNSYSTEM-VN|wix_com_inc|HGINDIA-AP|UK-RHINOCLOUD-20190730|PL-767|LT-LITHUANIA-20000725|ANSL-HK|SK-WEBSUPPORT-SERVERS|TimeWeb-1|RR-COMM-MIDSOUTH-2|TARHELY-NET|HGBLOCK-3',netname)
    if Match:
        return 1
    else:
        return 0
    
def get_feature_netname(dataframe):
    try:
        dataframe['netname'] = dataframe['url'].apply(get_netname)
        #dataframe.to_csv('C:/URL/abnormal_dataset/netname/netname.csv', index=False) #파일 이름 계속 바꿔서...?
        #dataframe['netname'] = dataframe['netname'].fillna('')
        #dataframe['netname']=dataframe['netname'].apply(check_netname)
    except Exception as e:
        print(f"Error processing URLs: {e}")

"""
csv_file_path = 'C:/URL/abnormal_dataset/netname/URLhaus+openphish_url_0111_netname.csv' #'C:/URL/normal_dataset/success/example10.csv' 
df = pd.read_csv(csv_file_path)#, header=None)#, names=['url'])
get_feature_netname(df)
df.to_csv('C:/URL/abnormal_dataset/netname/netnamefeature.csv', index=False)
"""